<!-- احفظي كملف: laser_dodger.html ثم افتحيه في المتصفح -->
<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Laser Dodger — لعبة</title>
<style>
  html,body {height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto;}
  canvas {display:block;margin:0 auto;background:#0b0b12;box-shadow:0 6px 30px rgba(0,0,0,0.6);border-radius:8px}
  #ui{width:640px;margin:12px auto;text-align:center;color:#eee}
  button{padding:8px 14px;border-radius:6px;border:none;cursor:pointer}
</style>
</head>
<body>
  <div id="ui">
    <h2>Laser Dodger — استخدمي الأسهم للتحرك</h2>
    <div>Score: <span id="score">0</span> &nbsp; Lives: <span id="lives">3</span></div>
    <div style="margin-top:8px">
      <button id="start">Start / Restart</button>
      <label style="margin-left:10px;color:#bbb;font-size:13px">Difficulty:
        <select id="diff">
          <option value="0.9">Normal</option>
          <option value="0.8">Hard</option>
          <option value="0.7">Very Hard</option>
        </select>
      </label>
    </div>
    <p style="color:#bbb;font-size:13px">تجنبي الليزرات الحمراء — كل ما يزيد الوقت كل ما السرعة تزداد.</p>
  </div>
  <canvas id="c" width="640" height="640"></canvas>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;
let scoreEl = document.getElementById('score');
let livesEl = document.getElementById('lives');
let startBtn = document.getElementById('start');
let diffSelect = document.getElementById('diff');

let keys = {};
let game = null;

class Player {
  constructor() { this.x = W/2; this.y = H/2; this.r = 10; this.speed = 260; }
  update(dt){
    if(keys.ArrowLeft) this.x -= this.speed * dt;
    if(keys.ArrowRight) this.x += this.speed * dt;
    if(keys.ArrowUp) this.y -= this.speed * dt;
    if(keys.ArrowDown) this.y += this.speed * dt;
    this.x = Math.max(this.r, Math.min(W - this.r, this.x));
    this.y = Math.max(this.r, Math.min(H - this.r, this.y));
  }
  draw(){
    ctx.beginPath();
    ctx.fillStyle = '#7fffd4';
    ctx.arc(this.x, this.y, this.r, 0, Math.PI*2);
    ctx.fill();
  }
}

class Laser {
  // spawn from edge towards random point inside
  constructor(speed){
    this.size = 6 + Math.random()*4;
    this.speed = speed;
    // pick edge
    const edge = Math.floor(Math.random()*4);
    if(edge===0){ this.x = -10; this.y = Math.random()*H; }
    if(edge===1){ this.x = W+10; this.y = Math.random()*H; }
    if(edge===2){ this.x = Math.random()*W; this.y = -10; }
    if(edge===3){ this.x = Math.random()*W; this.y = H+10; }
    // aim at point with slight randomness
    const targetX = Math.random()*W;
    const targetY = Math.random()*H;
    const dx = targetX - this.x, dy = targetY - this.y;
    const len = Math.hypot(dx,dy) || 1;
    this.vx = dx/len * this.speed;
    this.vy = dy/len * this.speed;
    this.color = '#ff3b3b';
  }
  update(dt){ this.x += this.vx*dt; this.y += this.vy*dt; }
  draw(){
    ctx.beginPath();
    ctx.fillStyle = this.color;
    ctx.ellipse(this.x,this.y, this.size*2, this.size/1.4, 0, 0, Math.PI*2);
    ctx.fill();
  }
  outOfBounds(){ return this.x < -50 || this.x > W+50 || this.y < -50 || this.y > H+50; }
}

function startGame(){
  const diff = parseFloat(diffSelect.value);
  game = {
    player: new Player(),
    lasers: [],
    spawnTimer: 0,
    spawnInterval: 0.9,
    baseLaserSpeed: 120,
    elapsed: 0,
    score: 0,
    lives: 3,
    difficultyFactor: diff,
    running:true
  };
  scoreEl.textContent = '0';
  livesEl.textContent = '3';
}

function update(dt){
  if(!game || !game.running) return;
  game.elapsed += dt;
  game.player.update(dt);
  // increase difficulty gradually
  const speedUp = 1 + Math.log(1+game.elapsed/12) * (1/game.difficultyFactor);
  game.spawnTimer += dt;
  // spawn logic: spawn faster over time
  const interval = Math.max(0.18, game.spawnInterval * Math.pow(game.difficultyFactor, game.elapsed/20));
  if(game.spawnTimer > interval){
    game.spawnTimer = 0;
    const s = game.baseLaserSpeed * speedUp * (1 + Math.random()*0.6);
    game.lasers.push(new Laser(s));
  }
  // update lasers
  for(let L of game.lasers) L.update(dt);
  // collision
  for(let i = game.lasers.length-1; i>=0; --i){
    const L = game.lasers[i];
    const dx = L.x - game.player.x, dy = L.y - game.player.y;
    const dist = Math.hypot(dx,dy);
    if(dist < game.player.r + L.size*1.2){
      // hit
      game.lasers.splice(i,1);
      game.lives -= 1;
      livesEl.textContent = game.lives;
      // small flash
      flash(6);
      if(game.lives <= 0) endGame();
    } else if(L.outOfBounds()){
      game.lasers.splice(i,1);
      game.score += 1;
      scoreEl.textContent = game.score;
    }
  }
}

let flashTimer = 0;
function flash(t){ flashTimer = t; }

function draw(){
  // background
  ctx.clearRect(0,0,W,H);
  // subtle grid
  ctx.save();
  ctx.globalAlpha = 0.06;
  ctx.strokeStyle = '#88a';
  for(let x=0;x<W;x+=32){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,H); ctx.stroke(); }
  for(let y=0;y<H;y+=32){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(W,y); ctx.stroke(); }
  ctx.restore();

  // draw lasers behind
  for(let L of game.lasers) L.draw();
  // player
  game.player.draw();

  if(flashTimer>0){
    flashTimer -= 1;
    ctx.fillStyle = 'rgba(255,80,80,0.14)';
    ctx.fillRect(0,0,W,H);
  }

  if(!game.running){
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.fillRect(0,0,W,H);
    ctx.fillStyle = '#fff';
    ctx.textAlign = 'center';
    ctx.font = '28px system-ui';
    ctx.fillText('Game Over — اضغطي Start لإعادة اللعب', W/2, H/2 - 10);
    ctx.font = '16px system-ui';
    ctx.fillText('Score: ' + game.score, W/2, H/2 + 24);
  }
}

function endGame(){
  game.running = false;
}

let last = null;
function loop(ts){
  if(!last) last = ts;
  const dt = Math.min(0.04, (ts - last)/1000);
  last = ts;
  if(game) update(dt);
  if(game) draw();
  requestAnimationFrame(loop);
}

startBtn.addEventListener('click', ()=> startGame());
window.addEventListener('keydown', e => { keys[e.key] = true; if(e.key===' ' && game && !game.running) startGame(); });
window.addEventListener('keyup', e => { keys[e.key] = false; });

startGame();
requestAnimationFrame(loop);
</script>
</body>
</html>